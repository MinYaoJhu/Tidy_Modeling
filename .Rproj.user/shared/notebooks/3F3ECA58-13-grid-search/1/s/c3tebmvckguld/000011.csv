"0","#| echo = FALSE, "
"0","#| message = FALSE, "
"0","#| fig.height = 7, "
"0","#| out.width = ""70%"","
"0","#| fig.cap = ""Worker processes when preprocessing and modeling tasks are distributed to many workers"","
"0","#| fig.alt = ""A diagram of the worker processes when preprocessing and modeling tasks are distributed to many workers. In this instance, more comprehensive parallelization is used but some preprocessing tasks are repeated across worker processes."""
"0",""
"0","load(""extras/parallel_times/everything_times.RData"")"
"0",""
"0","repeats <- "
"0","  everything_times %>% "
"0","  dplyr::filter(id == ""Fold1"" & event == ""preproc"") %>% "
"0","  nrow()"
"0",""
"0","everything_times <- "
"0"," everything_times %>%"
"0"," dplyr::rename(operation = label) %>% "
"0"," mutate(operation = as.character(operation)) %>% "
"0"," arrange(pid, id, operation) %>% "
"0"," select(pid, id, operation, duration)"
"0",""
"0","start_stop <- "
"0"," everything_times %>%"
"0"," pivot_wider("
"0","  id_cols = c(pid, id),"
"0","  names_from = ""operation"","
"0","  values_from = ""duration"""
"0"," ) %>% "
"0"," group_by(pid) %>% "
"0"," mutate("
"0","  total = model + preprocess,"
"0","  .stop_mod = cumsum(total),"
"0","  prev = dplyr::lag(total, 1),"
"0","  prev = ifelse(is.na(prev), 0, prev),"
"0","  .start_pre = cumsum(prev),"
"0","  .stop_pre = .start_pre + preprocess,"
"0","  .start_mod = .stop_pre"
"0"," ) %>% "
"0"," ungroup()  %>% "
"0"," select(pid, id, .start_pre, .stop_pre, .start_mod, .stop_mod) "
"0",""
"0","starts <- "
"0"," start_stop %>% "
"0"," select(pid, id, contains(""start"")) %>% "
"0"," pivot_longer("
"0","  cols = c(.start_pre, .start_mod),"
"0","  values_to = "".start"""
"0"," ) %>% "
"0"," mutate("
"0","  operation = ifelse(grepl(""mod$"", name), ""model"", ""preprocess"")"
"0"," ) %>% "
"0"," select(-name)"
"0",""
"0","stops <- "
"0"," start_stop %>% "
"0"," select(pid, id, contains(""stop"")) %>% "
"0"," pivot_longer("
"0","  cols = c(.stop_pre, .stop_mod),"
"0","  values_to = "".stop"""
"0"," ) %>% "
"0"," mutate("
"0","  operation = ifelse(grepl(""mod$"", name), ""model"", ""preprocess"")"
"0"," ) %>% "
"0"," select(-name)"
"0",""
"0","id_offset <- 0.4"
"0","start_stop_dat <- "
"0"," full_join(starts, stops, by = c(""pid"", ""id"", ""operation"")) %>% "
"0"," mutate("
"0","  id_num = as.numeric(factor(id)),"
"0","  id_start = id_num - id_offset,"
"0","  id_stop  = id_num + id_offset"
"0","  )"
"0",""
"0","start_stop_dat %>% "
"0"," ggplot(aes(y = id_num, x = .start)) +"
"0"," geom_rect("
"0","  aes("
"0","   xmin = .start,"
"0","   xmax = .stop,"
"0","   ymin = id_start,"
"0","   ymax = id_stop,"
"0","   fill = operation"
"0","  ),"
"0","  color = ""black"""
"0"," ) +"
"0"," facet_wrap(~ pid, nrow = 2) +"
"0"," labs(y = NULL, x = ""Elapsed Time"") + "
"0"," scale_fill_brewer(palette = ""Paired"") +"
"0"," scale_y_continuous(breaks = 1:5, labels = paste(""Fold"", 1:5)) +"
"0"," theme_bw() +"
"0"," theme(legend.position = ""top"", panel.grid.minor = element_blank())"
