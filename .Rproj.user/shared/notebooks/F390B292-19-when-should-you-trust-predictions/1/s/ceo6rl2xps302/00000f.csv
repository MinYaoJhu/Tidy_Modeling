"0","#| echo = FALSE, "
"0","#| out.width = ""100%"","
"0","#| fig.cap = ""The PCA reference distribution based on the training set"","
"0","#| fig.alt = ""The PCA reference distribution based on the training set. The majority of the distances to the center of the PCA distribution are below a value of three."""
"0",""
"0","pca_rec <- recipe(~ ., data = Chicago_train) %>% "
"0","  step_normalize(California, Austin) %>% "
"0","  step_pca(California, Austin, num_comp = 2) %>% "
"0","  prep()"
"0",""
"0","training_pca <- bake(pca_rec, new_data = NULL)"
"0","pca_center <- "
"0","  training_pca %>% "
"0","  select(PC1, PC2) %>% "
"0","  summarize(PC1_mean = mean(PC1), PC2_mean = mean(PC2))"
"0",""
"0","training_pca <- "
"0","  cbind(pca_center, training_pca) %>% "
"0","  mutate("
"0","    distance = (PC1 - PC1_mean)^2 + (PC2 - PC2_mean)^2,"
"0","    distance = sqrt(distance)"
"0","  )"
"0",""
"0","testing_pca <- "
"0","  bake(pca_rec, Chicago_test %>% slice(1)) %>% "
"0","  cbind(pca_center) %>% "
"0","  mutate("
"0","    distance = (PC1 - PC1_mean)^2 + (PC2 - PC2_mean)^2,"
"0","    distance = sqrt(distance)"
"0","  )"
"0","testing_pctl <- round(mean(training_pca$distance <= testing_pca$distance) * 100, 1)"
"0",""
"0","new_pca <- "
"0","  bake(pca_rec, Chicago_2020 %>% slice(6)) %>% "
"0","  cbind(pca_center) %>% "
"0","  mutate("
"0","    distance = (PC1 - PC1_mean)^2 + (PC2 - PC2_mean)^2,"
"0","    distance = sqrt(distance)"
"0","  )"
"0","new_pctl <- round(mean(training_pca$distance <= new_pca$distance) * 100, 1)"
"0",""
"0","tr_plot <- "
"0","  Chicago_train %>% "
"0","  ggplot(aes(x = California, y = Austin)) + "
"0","  geom_point(alpha = .25, size = .3) + "
"0","  # coord_equal() + "
"0","  labs(title = ""(a) Training Set"") + "
"0","  theme(plot.title = element_text(size=9))"
"0",""
"0","pca_plot <- training_pca %>% "
"0","  ggplot(aes(x = PC1, y = PC2)) + "
"0","  geom_point(alpha = .25, size = .3) + "
"0","  coord_obs_pred() + "
"0","  labs(x = ""Component 1"", y = ""Component 2"", title = ""(b) Training Set PCA Scores"") +"
"0","  theme(plot.title = element_text(size = 9))"
"0",""
"0","pca_dist <- "
"0","  training_pca %>% "
"0","  ggplot() + "
"0","  geom_segment(aes(x = PC1_mean, y = PC2_mean,"
"0","                   xend = PC1, yend = PC2), alpha = .1)  + "
"0","  coord_obs_pred() + "
"0","  labs(x = ""Component 1"", y = ""Component 2"", title = ""(c) Distances to Center"") +"
"0","  theme(plot.title = element_text(size = 9))"
"0",""
"0","dist_hist <-"
"0","  training_pca %>%"
"0","  ggplot(aes(x = distance)) +"
"0","  geom_histogram(bins = 30, color = ""white"") +"
"0","  labs(x = ""Distance to Training Set Center"", title = ""(d) Reference Distribution"") +"
"0","  theme(plot.title = element_text(size = 9))"
"0",""
"0","library(patchwork)"
"0","tr_plot + pca_plot + pca_dist + dist_hist"
